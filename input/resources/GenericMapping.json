{
  "resourceType": "StructureMap",
  "id": "GenericMapping",
  "meta": {
    "versionId": "1",
    "lastUpdated": "2023-04-20T05:15:50.059+00:00"
  },
  "text": {
    "status": "generated",
    "div": "<div xmlns=\"http://www.w3.org/1999/xhtml\"><pre>map &quot;http://hcisolutions.ch/ig/ig-hci-vacd/StructureMap/GenericMapping&quot; = &quot;GenericMapping&quot;\r\n\r\n// FHIR Bundle to HCI Form QuestionnaireResponse mapping\r\n// 2021-10-21 Roeland Luykx, copyright HCI Solutions AG\r\n\r\nuses &quot;http://hl7.org/fhir/StructureDefinition/Bundle&quot; alias Bundle as source\r\nuses &quot;http://hl7.org/fhir/StructureDefinition/Composition&quot; alias Composition as source\r\nuses &quot;http://hl7.org/fhir/StructureDefinition/Patient&quot; alias Patient as source\r\nuses &quot;http://hl7.org/fhir/StructureDefinition/Organization&quot; alias Organization as source\r\nuses &quot;http://hl7.org/fhir/StructureDefinition/Practitioner&quot; alias Practitioner as source\r\nuses &quot;http://hl7.org/fhir/StructureDefinition/PractitionerRole&quot; alias PractitionerRole as source\r\nuses &quot;http://hl7.org/fhir/StructureDefinition/BackboneElement&quot; alias BackboneElement as source\r\nuses &quot;http://hl7.org/fhir/StructureDefinition/Condition&quot; alias Condition as source\r\nuses &quot;http://hl7.org/fhir/StructureDefinition/Observation&quot; alias Observation as source\r\nuses &quot;http://hl7.org/fhir/StructureDefinition/Identifier&quot; alias Identifier as source\r\nuses &quot;http://hl7.org/fhir/StructureDefinition/QuestionnaireResponse&quot; alias QuestionnaireResponse as target // group DoAdministrationBasicImmunization(source bundle : Bundle, source section : BackboneElement, target vaccines : BackboneElement) {\r\n\r\ngroup DoAdministrationBasicImmunization(source bundle : Bundle, target vaccines : BackboneElement) {\r\n  // section.entry as secBaIm /*where ($this.type = 'Condition')*/ then {\r\n  bundle.entry as entry1 where ($this.resource.ofType(FHIR.Condition)) then {\r\n    entry1.resource as resource then {\r\n      resource.code as code where ($this.coding.code = 'cds-dtpa-basicimmun') then {\r\n        resource -&gt; vaccines.item as vaccEntry then {\r\n          code -&gt;  vaccEntry.linkId = 'form.vaccines.questBasicImmunDtpa',  vaccEntry.text = 'Alle Impfungen gegen DTPa in der Kindheit erhalten.',  vaccEntry.answer as answer,  answer.value = true &quot;answer&quot;;\r\n        } &quot;vaccEntry&quot;;\r\n      };\r\n      resource.code as code where ($this.coding.code = 'cds-polio-basicimmun') then {\r\n        resource -&gt; vaccines.item as vaccEntry then {\r\n          code -&gt;  vaccEntry.linkId = 'form.vaccines.questBasicImmunPolio',  vaccEntry.text = 'Alle Impfungen gegen Poliomyelitis in der Kindheit erhalten.',  vaccEntry.answer as answer,  answer.value = true &quot;answer&quot;;\r\n        } &quot;vaccEntry&quot;;\r\n      };\r\n    };\r\n  } &quot;entry1&quot;;\r\n}\r\n\r\n// group DoAdministration(source bundle : Bundle, source section : BackboneElement, target vaccines : BackboneElement) {\r\ngroup DoAdministration(source bundle : Bundle, target vaccines : BackboneElement) {\r\n  // section.entry as secBaIm /*where ($this.type = 'Condition')*/ then {\r\n  bundle.entry as entry1 where ($this.resource.ofType(FHIR.Immunization)) then {\r\n    entry1.resource as resource then {\r\n      resource -&gt; vaccines.item as vaccEntry then {\r\n        resource -&gt; vaccEntry.linkId = 'form.vaccines.entry' &quot;linkId&quot;;\r\n        resource -&gt; vaccEntry.text = 'Impfung' &quot;text&quot;;\r\n        resource.vaccineCode as vaccCode then {\r\n          vaccCode.coding as vaccCoding then {\r\n            vaccCode -&gt;  vaccEntry.item as vaccItem,  vaccItem.linkId = 'form.vaccines.questVaccineProduct',  vaccItem.text = 'Impfstoff',  vaccItem.answer as answer,  answer.value = vaccCoding &quot;vaccItem&quot;;\r\n          } &quot;vaccCoding&quot;;\r\n        } &quot;vaccCode&quot;;\r\n        resource.occurrenceDateTime as vaccDate then {\r\n          vaccDate -&gt;  vaccEntry.item as vaccItem,  vaccItem.linkId = 'form.vaccines.questVaccinationDate',  vaccItem.text = 'Impfdatum',  vaccItem.answer as answer,  answer.value = create('date') as dt,  dt.value = vaccDate &quot;vaccDate&quot;;\r\n        } &quot;vaccDate&quot;;\r\n      } &quot;vaccEntry&quot;;\r\n    };\r\n  } &quot;entry1&quot;;\r\n}\r\n\r\ngroup MedicalProblemsAddToItemSocial(source rcode : CodeableConcept, target questSocial : BackboneElement) {\r\n  rcode.coding as coding where ($this.system = 'http://snomed.info/sct') then {\r\n    // Social\r\n    coding.code as code where (($this.value = '169449001') or ($this.value = '224224003') or ($this.value = '105568001')) then {\r\n      code -&gt;  questSocial.answer as answr,  answr.value = coding &quot;answr&quot;;\r\n    };\r\n  } &quot;codingsct&quot;;\r\n  rcode.coding as coding where ($this.system = 'http://hcisolutions.ch/ig/ig-hci-vacd/CodeSystem/hci-vacd-cds-cs') then {\r\n    // Social\r\n    coding.code as code where (($this.value = '300001') or ($this.value = '300002') or ($this.value = '300003') or ($this.value = '300005')) then {\r\n      code -&gt;  questSocial.answer as answr,  answr.value = coding &quot;coding&quot;;\r\n    };\r\n  } &quot;codinghci&quot;;\r\n}\r\n\r\ngroup MedicalProblemsAddToItemPreillness(source rcode : CodeableConcept, target questPreIllnesses : BackboneElement) {\r\n  rcode.coding as coding where ($this.system = 'http://snomed.info/sct') then {\r\n    // PrevIllness\r\n    coding.code as code where (($this.value = '42261000195101') or ($this.value = '42251000195104') or ($this.value = '449840001') or ($this.value = '50043002') or ($this.value = '737294004') or ($this.value = '51244008') or ($this.value = '230744007') or ($this.value = '363346000') or ($this.value = '51655004') or ($this.value = '235856003') or ($this.value = '402196005') or ($this.value = '90708001') or ($this.value = '414029004') or ($this.value = '56265001') or ($this.value = '75934005') or ($this.value = '34093004') or ($this.value = '24063002')) then {\r\n      code -&gt;  questPreIllnesses.answer as answr,  answr.value = coding &quot;answr&quot;;\r\n    };\r\n  } &quot;codingsct&quot;;\r\n  rcode.coding as coding where ($this.system = 'http://hcisolutions.ch/ig/ig-hci-vacd/CodeSystem/hci-vacd-cds-cs') &quot;codinghci&quot;;\r\n}\r\n\r\ngroup MedicalProblemsAddToItemRisks(source rcode : CodeableConcept, target questRisks : BackboneElement) {\r\n  rcode.coding as coding where ($this.system = 'http://snomed.info/sct') then {\r\n    // Riskfactor\r\n    coding.code as code where (($this.value = '226034001') or ($this.value = '102947004') or ($this.value = '305679000') or ($this.value = '305679000') or ($this.value = '1237016007') or ($this.value = '305679000') or ($this.value = '1237016007') or ($this.value = '1237017003') or ($this.value = '1237018008') or ($this.value = '1237022003') or ($this.value = '1237019000') or ($this.value = '1237020006') or ($this.value = '1237021005') or ($this.value = '1237023008') or ($this.value = '1237024002') or ($this.value = '1237025001') or ($this.value = '1237026000') or ($this.value = '1237027009') or ($this.value = '1237028004') or ($this.value = '1237029007') or ($this.value = '1237030002')) then {\r\n      code -&gt;  questRisks.answer as answr,  answr.value = coding &quot;answr&quot;;\r\n    };\r\n  } &quot;codingsct&quot;;\r\n  rcode.coding as coding where ($this.system = 'http://hcisolutions.ch/ig/ig-hci-vacd/CodeSystem/hci-vacd-cds-cs') then {\r\n    // Riskfactor\r\n    coding.code as code where (($this.value = '200001') or ($this.value = '200002') or ($this.value = '200003') or ($this.value = '200005') or ($this.value = '200022') or ($this.value = '200023')) then {\r\n      code -&gt;  questRisks.answer as answr,  answr.value = coding &quot;answr&quot;;\r\n    };\r\n  } &quot;codinghci&quot;;\r\n}\r\n\r\ngroup MedicalProblemsAddToItemOccupation(source rcode : CodeableConcept, target questOccupation : BackboneElement) {\r\n  rcode.coding as coding where ($this.system = 'http://snomed.info/sct') then {\r\n    // Profession\r\n    coding.code as code where (($this.value = '310183005') or ($this.value = '160157004') or ($this.value = '265940000') or ($this.value = '61246008')) then {\r\n      code -&gt;  questOccupation.answer as answr,  answr.value = coding &quot;answr&quot;;\r\n    };\r\n  } &quot;codingsct&quot;;\r\n  rcode.coding as coding where ($this.system = 'http://hcisolutions.ch/ig/ig-hci-vacd/CodeSystem/hci-vacd-cds-cs') then {\r\n    // Profession\r\n    coding.code as code where (($this.value = '100001') or ($this.value = '100002') or ($this.value = '100003')) then {\r\n      code -&gt;  questOccupation.answer as answr,  answr.value = coding &quot;coding&quot;;\r\n    };\r\n  } &quot;codinghci&quot;;\r\n}\r\n\r\n// group MedicalProblemsAddToItem(source rcode : CodeableConcept, target questSocial : BackboneElement, target questPreIllnesses : BackboneElement, target questRisks : BackboneElement, target questOccupation : BackboneElement) {\r\n// // Note: in place of or chaining a resolution of the categorie using a concept map would be nice. mappig does not yet have this functionality\r\n// rcode.coding as coding where ($this.system = 'http://snomed.info/sct') then {\r\n// // Riskfactor\r\n// coding.code as code where ( $this.value = '226034001' or $this.value = '102947004' or $this.value = '305679000' or $this.value = '305679000' or $this.value = '1237016007' or $this.value = '305679000' or $this.value = '1237016007' or $this.value = '1237017003' or $this.value = '1237018008' or $this.value = '1237022003' or $this.value = '1237019000' or $this.value = '1237020006' or $this.value = '1237021005' or $this.value = '1237023008' or $this.value = '1237024002' or $this.value = '1237025001' or $this.value = '1237026000' or $this.value = '1237027009' or $this.value = '1237028004' or $this.value = '1237029007' or $this.value = '1237030002' ) then {\r\n// code -&gt; questRisks.answer as answr, answr.value = coding &quot;answr&quot;;\r\n// } &quot;code&quot;;\r\n// // PrevIllness\r\n// coding.code as code where ( $this.value = '42261000195101' or $this.value = '42251000195104' or $this.value = '449840001' or $this.value = '50043002' or $this.value = '737294004' or $this.value = '51244008' or $this.value = '230744007' or $this.value = '363346000' or $this.value = '51655004' or $this.value = '235856003' or $this.value = '402196005' or $this.value = '90708001' or $this.value = '414029004' or $this.value = '56265001' or $this.value = '75934005' or $this.value = '34093004' or $this.value = '24063002' ) then {\r\n// code -&gt; questPreIllnesses.answer as answr, answr.value = coding &quot;answr&quot;;\r\n// } &quot;code&quot;;\r\n// // Social\r\n// coding.code as code where ( $this.value = '169449001' or $this.value = '224224003' or $this.value = '105568001') then {\r\n// code -&gt; questSocial.answer as answr, answr.value = coding &quot;answr&quot;;\r\n// } &quot;code&quot;;\r\n// // Profession\r\n// coding.code as code where ( $this.value = '310183005' or $this.value = '160157004' or $this.value = '265940000' or $this.value = '61246008') then {\r\n// code -&gt; questOccupation.answer as answr, answr.value = coding &quot;answr&quot;;\r\n// } &quot;code&quot;;\r\n// } &quot;codingsct&quot;;\r\n// rcode.coding as coding where ($this.system = 'http://hcisolutions.ch/ig/ig-hci-vacd/CodeSystem/hci-vacd-cds-cs') then {\r\n// // Riskfactor\r\n// coding.code as code where ( $this.value = '200001' or $this.value = '200002' or $this.value = '200003' or $this.value = '200005' or $this.value = '200022' or $this.value = '200023') then {\r\n// code -&gt; questRisks.answer as answr, answr.value = coding &quot;answr&quot;;\r\n// } &quot;code&quot;;\r\n// // Social\r\n// coding.code as code where ( $this.value = '300001' or $this.value = '300002' or $this.value = '300003' or $this.value = '300005') then {\r\n// code -&gt; questSocial.answer as answr, answr.value = coding &quot;coding&quot;;\r\n// } &quot;code&quot;;\r\n// // Profession\r\n// coding.code as code where ( $this.value = '100001' or $this.value = '100002' or  $this.value = '100003') then {\r\n// code -&gt; questOccupation.answer as answr, answr.value = coding &quot;coding&quot;;\r\n// } &quot;code&quot;;\r\n// } &quot;codinghci&quot;;\r\n// // rcode.coding as coding -&gt; translate(coding, 'http://hcisolutions.ch/ig/ig-hci-vacd/ConceptMap/hci-vacd-medicalrisks-riskcategories-cm', 'CodeableConcept') as displ,\r\n// //     questOccupation.answer as answr,\r\n// //       answr.value = displ &quot;translate&quot;;\r\n// }\r\ngroup DoContained(source entry : BackboneElement, target qr : QuestionnaireResponse) {\r\n  entry.fullUrl as fullUrl then {\r\n    entry.resource as patient where $this.ofType(FHIR.Patient) then {\r\n      patient -&gt;  qr.contained = patient as pat,  pat.id = fullUrl,  qr.subject = create('Reference') as reference,  reference.reference = (%pat.id) &quot;pat&quot;;\r\n    } &quot;patient&quot;;\r\n    entry.resource as practitionerrole where $this.ofType(FHIR.PractitionerRole) then {\r\n      practitionerrole -&gt;  qr.contained = practitionerrole as pr,  pr.id = fullUrl,  qr.author = create('Reference') as reference,  reference.reference = (%pr.id) &quot;pr&quot;;\r\n    } &quot;practitionerrole&quot;;\r\n    entry.resource as practitioner where $this.ofType(FHIR.Practitioner) then {\r\n      practitioner -&gt;  qr.contained = practitioner as pra,  pra.id = fullUrl &quot;pract&quot;;\r\n    } &quot;practitioner&quot;;\r\n    entry.resource as organization where $this.ofType(FHIR.Organization) then {\r\n      organization -&gt;  qr.contained = organization as org,  org.id = fullUrl &quot;org&quot;;\r\n    } &quot;organization&quot;;\r\n  };\r\n}\r\n\r\ngroup DoTiterAndIllnesses(source bundle : Bundle, target titerandillnesses : BackboneElement) {\r\n  // Lab results\r\n  bundle.entry as entry where ($this.resource.ofType(FHIR.Observation)) then {\r\n    entry.resource as resource then {\r\n      // resource.meta where ($this.profile = 'http://fhir.ch/ig/ch-vacd/StructureDefinition/ch-vacd-laboratory-serology') then {\r\n      resource.code as cc then {\r\n        resource.value as value then {\r\n          // form.patientinfo.questHibKnownTiter\r\n          cc.coding as coding where (($this.system = 'http://loinc.org') and ($this.code = '22755-3')) then {\r\n            value.value as valQu -&gt;  titerandillnesses.item as hibTit,  hibTit.linkId = 'form.patientinfo.questHibKnownTiter',  hibTit.text = 'Hämophilus influenzae Typ b (mg/l)',  hibTit.answer as answ,  answ.value = valQu;\r\n          };\r\n          // form.patientinfo.questVarizKnownTiter\r\n          cc.coding as coding where (($this.system = 'http://loinc.org') and ($this.code = '22602-7')) then {\r\n            value.value as valQu -&gt;  titerandillnesses.item as hibTit,  hibTit.linkId = 'form.patientinfo.questVarizKnownTiter',  hibTit.text = 'Varizellen (IU/l)',  hibTit.answer as answ,  answ.value = valQu;\r\n          };\r\n          // form.patientinfo.questHepBAntibodyTiter\r\n          cc.coding as coding where (($this.system = 'http://loinc.org') and ($this.code = '16935-9')) then {\r\n            value.value as valQu -&gt;  titerandillnesses.item as hibTit,  hibTit.linkId = 'form.patientinfo.questHepBAntibodyTiter',  hibTit.text = 'Hepatitis B (IU/l)',  hibTit.answer as answ,  answ.value = valQu;\r\n          };\r\n          // form.patientinfo.questTwutAntibodyTiter\r\n          cc.coding as coding where (($this.system = 'http://loinc.org') and ($this.code = '14128-3')) then {\r\n            value.value as valQu -&gt;  titerandillnesses.item as hibTit,  hibTit.linkId = 'form.patientinfo.questTwutAntibodyTiter',  hibTit.text = 'Tollwut (IU/ml)',  hibTit.answer as answ,  answ.value = valQu;\r\n          };\r\n        };\r\n      } &quot;cc&quot;;\r\n    };\r\n  };\r\n  // pastillnesses\r\n  bundle.entry as entry where ($this.resource.ofType(FHIR.Condition)) then {\r\n    entry.resource as resource then {\r\n      // resource.meta where ($this.profile = 'http://fhir.ch/ig/ch-vacd/StructureDefinition/ch-vacd-pastillnesses') then {\r\n      resource.code as cc then {\r\n        // form.patientinfo.questVarizIllUndergone\r\n        cc.coding as coding where (($this.system = 'http://snomed.info/sct') and ($this.code = '38907003')) then {\r\n          coding -&gt;  titerandillnesses.item as illUnder,  illUnder.linkId = 'form.patientinfo.questVarizIllUndergone',  illUnder.text = 'Wurde bereits eine Varizellen-Erkrankung durchgemacht?',  illUnder.answer as answ,  answ.value = true &quot;value&quot;;\r\n        };\r\n        // form.patientinfo.questRubeusIllUndergone\r\n        cc.coding as coding where (($this.system = 'http://snomed.info/sct') and ($this.code = '36653000')) then {\r\n          coding -&gt;  titerandillnesses.item as illUnder,  illUnder.linkId = 'form.patientinfo.questRubeusIllUndergone',  illUnder.text = '',  illUnder.answer as answ,  answ.value = true &quot;value&quot;;\r\n        };\r\n        // form.patientinfo.questMeasleIllUndergone\r\n        cc.coding as coding where (($this.system = 'http://snomed.info/sct') and ($this.code = '14189004')) then {\r\n          coding -&gt;  titerandillnesses.item as illUnder,  illUnder.linkId = 'form.patientinfo.questMeasleIllUndergone',  illUnder.text = '',  illUnder.answer as answ,  answ.value = true &quot;value&quot;;\r\n        };\r\n        // form.patientinfo.questHepAIllUndergone\r\n        cc.coding as coding where (($this.system = 'http://snomed.info/sct') and ($this.code = '40468003')) then {\r\n          coding -&gt;  titerandillnesses.item as illUnder,  illUnder.linkId = 'form.patientinfo.questHepAIllUndergone',  illUnder.text = 'Wurde bereits eine Hepatitis A-Erkrankung durchgemacht?',  illUnder.answer as answ,  answ.value = true &quot;value&quot;;\r\n        };\r\n        // form.patientinfo.questHepBIllUndergone\r\n        cc.coding as coding where (($this.system = 'http://snomed.info/sct') and ($this.code = '66071002')) then {\r\n          coding -&gt;  titerandillnesses.item as illUnder,  illUnder.linkId = 'form.patientinfo.questHepBIllUndergone',  illUnder.text = 'Wurde bereits eine Hepatitis B-Erkrankung durchgemacht?',  illUnder.answer as answ,  answ.value = true &quot;value&quot;;\r\n        };\r\n      } &quot;cc&quot;;\r\n    };\r\n  };\r\n}\r\n\r\ngroup DoPatinfoGeneric(source bundle : Bundle, target patientinfo : BackboneElement) {\r\n  // form.patientinfo.questSocialFacts\r\n  bundle -&gt; patientinfo.item as questSocial then {\r\n    bundle -&gt;  questSocial.linkId = 'form.patientinfo.questSocialFacts',  questSocial.text = 'Soziale Faktoren' &quot;linkIdtext&quot;;\r\n    // form.patientinfo.questSocialLivingRisk\r\n    bundle -&gt; patientinfo.item as questSocialLivingRisk then {\r\n      bundle -&gt;  questSocialLivingRisk.linkId = 'form.patientinfo.questSocialLivingRisk',  questSocialLivingRisk.text = 'Ist der Wohnort oder Aufenthalt innerhalb CH ausser Genf und Tessin? (FSME)',  questSocialLivingRisk.answer as answSocialLivingRisk then {\r\n        // form.patientinfo.questPreIllnesses\r\n        bundle -&gt; patientinfo.item as questPreIllnesses then {\r\n          bundle -&gt;  questPreIllnesses.linkId = 'form.patientinfo.questPreIllnesses',  questPreIllnesses.text = 'Vorerkrankungen' &quot;linkIdtext&quot;;\r\n          // form.patientinfo.questRisks\r\n          bundle -&gt; patientinfo.item as questRisks then {\r\n            bundle -&gt;  questRisks.linkId = 'form.patientinfo.questRisks',  questRisks.text = 'Risikofaktoren' &quot;linkIdtext&quot;;\r\n            // form.patientinfo.questPregnancy\r\n            bundle -&gt; patientinfo.item as questPregnancy then {\r\n              bundle -&gt;  questPregnancy.linkId = 'form.patientinfo.questPregnancy',  questPregnancy.text = 'Ist die Person schwanger?',  questPregnancy.answer as answPreg then {\r\n                // form.patientinfo.questOccupation\r\n                bundle -&gt; patientinfo.item as questOccupation then {\r\n                  bundle -&gt;  questOccupation.linkId = 'form.patientinfo.questOccupation',  questOccupation.text = 'Beruf' &quot;linkIdtext&quot;;\r\n                  bundle.entry as entry where ($this.resource.ofType(FHIR.Condition)) then {\r\n                    entry.resource as resource where (($this.code.coding.code != '77386006') and ($this.code.coding.code != '300005')) then {\r\n                      // resource.meta where ($this.profile = 'http://fhir.ch/ig/ch-vacd/StructureDefinition/ch-vacd-medical-problems') then {\r\n                      resource.code as rcode then MedicalProblemsAddToItemSocial(rcode, questSocial) &quot;value&quot;;\r\n                      resource.code as rcode then MedicalProblemsAddToItemPreillness(rcode, questPreIllnesses) &quot;value&quot;;\r\n                      resource.code as rcode then MedicalProblemsAddToItemRisks(rcode, questRisks) &quot;value&quot;;\r\n                      resource.code as rcode then MedicalProblemsAddToItemOccupation(rcode, questOccupation) &quot;value&quot;;\r\n                    };\r\n                    entry.resource as resource where (($this.code.coding.code = '77386006') and ($this.code.coding.system = 'http://snomed.info/sct')) then {\r\n                      entry -&gt; answPreg.value = true &quot;valueBoolean&quot;;\r\n                    };\r\n                    // HCIC#300005 &quot;residence or stay whole CH except Geneva and Ticino&quot;\r\n                    entry.resource as resource where (($this.code.coding.code = '300005') and ($this.code.coding.system = 'http://hcisolutions.ch/ig/ig-hci-vacd/CodeSystem/hci-vacd-cds-cs')) then {\r\n                      entry -&gt; answSocialLivingRisk.value = true &quot;valueBoolean&quot;;\r\n                    };\r\n                  };\r\n                } &quot;questOccupation&quot;;\r\n              } &quot;answPreg&quot;;\r\n            } &quot;questPregnancy&quot;;\r\n          } &quot;questRisks&quot;;\r\n        } &quot;questPreIllnesses&quot;;\r\n      } &quot;answSocialLivingRisk&quot;;\r\n    } &quot;questSocialLivingRisk&quot;;\r\n  } &quot;questSocial&quot;;\r\n  // form.patientinfo.questVivoVaccineReceived\r\n  bundle.entry as entry1 where ($this.resource.ofType(FHIR.AllergyIntolerance)) then {\r\n    bundle -&gt; patientinfo.item as questAll then {\r\n      bundle -&gt; questAll.linkId = 'form.patientinfo.questAllergies' &quot;linkId&quot;;\r\n      bundle -&gt; questAll.text = 'Allergien / UAW' &quot;text&quot;;\r\n      entry1.resource as res then {\r\n        res.code as code1 then {\r\n          code1.coding as coding1 -&gt;  questAll.answer as answ1,  answ1.value = coding1;\r\n        };\r\n      } &quot;res&quot;;\r\n    } &quot;questAll&quot;;\r\n  };\r\n}\r\n\r\n</pre></div>"
  },
  "url": "http://hcisolutions.ch/ig/ig-hci-vacd/StructureMap/GenericMapping",
  "name": "GenericMapping",
  "description": "FHIR Bundle to HCI Form QuestionnaireResponse mapping\r\n2021-10-21 Roeland Luykx, copyright HCI Solutions AG",
  "structure": [ {
    "url": "http://hl7.org/fhir/StructureDefinition/Bundle",
    "mode": "source",
    "alias": "Bundle"
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/Composition",
    "mode": "source",
    "alias": "Composition"
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/Patient",
    "mode": "source",
    "alias": "Patient"
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/Organization",
    "mode": "source",
    "alias": "Organization"
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/Practitioner",
    "mode": "source",
    "alias": "Practitioner"
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/PractitionerRole",
    "mode": "source",
    "alias": "PractitionerRole"
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/BackboneElement",
    "mode": "source",
    "alias": "BackboneElement"
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/Condition",
    "mode": "source",
    "alias": "Condition"
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/Observation",
    "mode": "source",
    "alias": "Observation"
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/Identifier",
    "mode": "source",
    "alias": "Identifier"
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/QuestionnaireResponse",
    "mode": "target",
    "alias": "QuestionnaireResponse",
    "documentation": "group DoAdministrationBasicImmunization(source bundle : Bundle, source section : BackboneElement, target vaccines : BackboneElement) {"
  } ],
  "group": [ {
    "name": "DoAdministrationBasicImmunization",
    "typeMode": "none",
    "input": [ {
      "name": "bundle",
      "type": "Bundle",
      "mode": "source"
    }, {
      "name": "vaccines",
      "type": "BackboneElement",
      "mode": "target"
    } ],
    "rule": [ {
      "name": "entry1",
      "source": [ {
        "context": "bundle",
        "element": "entry",
        "variable": "entry1",
        "condition": "($this.resource.ofType(FHIR.Condition))"
      } ],
      "rule": [ {
        "name": "resource",
        "source": [ {
          "context": "entry1",
          "element": "resource",
          "variable": "resource"
        } ],
        "rule": [ {
          "name": "code",
          "source": [ {
            "context": "resource",
            "element": "code",
            "variable": "code",
            "condition": "($this.coding.code = 'cds-dtpa-basicimmun')"
          } ],
          "rule": [ {
            "name": "vaccEntry",
            "source": [ {
              "context": "resource"
            } ],
            "target": [ {
              "context": "vaccines",
              "contextType": "variable",
              "element": "item",
              "variable": "vaccEntry"
            } ],
            "rule": [ {
              "name": "answer",
              "source": [ {
                "context": "code"
              } ],
              "target": [ {
                "context": "vaccEntry",
                "contextType": "variable",
                "element": "linkId",
                "transform": "copy",
                "parameter": [ {
                  "valueString": "form.vaccines.questBasicImmunDtpa"
                } ]
              }, {
                "context": "vaccEntry",
                "contextType": "variable",
                "element": "text",
                "transform": "copy",
                "parameter": [ {
                  "valueString": "Alle Impfungen gegen DTPa in der Kindheit erhalten."
                } ]
              }, {
                "context": "vaccEntry",
                "contextType": "variable",
                "element": "answer",
                "variable": "answer"
              }, {
                "context": "answer",
                "contextType": "variable",
                "element": "value",
                "transform": "copy",
                "parameter": [ {
                  "valueBoolean": true
                } ]
              } ]
            } ]
          } ]
        }, {
          "name": "code",
          "source": [ {
            "context": "resource",
            "element": "code",
            "variable": "code",
            "condition": "($this.coding.code = 'cds-polio-basicimmun')"
          } ],
          "rule": [ {
            "name": "vaccEntry",
            "source": [ {
              "context": "resource"
            } ],
            "target": [ {
              "context": "vaccines",
              "contextType": "variable",
              "element": "item",
              "variable": "vaccEntry"
            } ],
            "rule": [ {
              "name": "answer",
              "source": [ {
                "context": "code"
              } ],
              "target": [ {
                "context": "vaccEntry",
                "contextType": "variable",
                "element": "linkId",
                "transform": "copy",
                "parameter": [ {
                  "valueString": "form.vaccines.questBasicImmunPolio"
                } ]
              }, {
                "context": "vaccEntry",
                "contextType": "variable",
                "element": "text",
                "transform": "copy",
                "parameter": [ {
                  "valueString": "Alle Impfungen gegen Poliomyelitis in der Kindheit erhalten."
                } ]
              }, {
                "context": "vaccEntry",
                "contextType": "variable",
                "element": "answer",
                "variable": "answer"
              }, {
                "context": "answer",
                "contextType": "variable",
                "element": "value",
                "transform": "copy",
                "parameter": [ {
                  "valueBoolean": true
                } ]
              } ]
            } ]
          } ]
        } ]
      } ],
      "documentation": "section.entry as secBaIm /*where ($this.type = 'Condition')*/ then {"
    } ]
  }, {
    "name": "DoAdministration",
    "typeMode": "none",
    "documentation": "group DoAdministration(source bundle : Bundle, source section : BackboneElement, target vaccines : BackboneElement) {",
    "input": [ {
      "name": "bundle",
      "type": "Bundle",
      "mode": "source"
    }, {
      "name": "vaccines",
      "type": "BackboneElement",
      "mode": "target"
    } ],
    "rule": [ {
      "name": "entry1",
      "source": [ {
        "context": "bundle",
        "element": "entry",
        "variable": "entry1",
        "condition": "($this.resource.ofType(FHIR.Immunization))"
      } ],
      "rule": [ {
        "name": "resource",
        "source": [ {
          "context": "entry1",
          "element": "resource",
          "variable": "resource"
        } ],
        "rule": [ {
          "name": "vaccEntry",
          "source": [ {
            "context": "resource"
          } ],
          "target": [ {
            "context": "vaccines",
            "contextType": "variable",
            "element": "item",
            "variable": "vaccEntry"
          } ],
          "rule": [ {
            "name": "linkId",
            "source": [ {
              "context": "resource"
            } ],
            "target": [ {
              "context": "vaccEntry",
              "contextType": "variable",
              "element": "linkId",
              "transform": "copy",
              "parameter": [ {
                "valueString": "form.vaccines.entry"
              } ]
            } ]
          }, {
            "name": "text",
            "source": [ {
              "context": "resource"
            } ],
            "target": [ {
              "context": "vaccEntry",
              "contextType": "variable",
              "element": "text",
              "transform": "copy",
              "parameter": [ {
                "valueString": "Impfung"
              } ]
            } ]
          }, {
            "name": "vaccCode",
            "source": [ {
              "context": "resource",
              "element": "vaccineCode",
              "variable": "vaccCode"
            } ],
            "rule": [ {
              "name": "vaccCoding",
              "source": [ {
                "context": "vaccCode",
                "element": "coding",
                "variable": "vaccCoding"
              } ],
              "rule": [ {
                "name": "vaccItem",
                "source": [ {
                  "context": "vaccCode"
                } ],
                "target": [ {
                  "context": "vaccEntry",
                  "contextType": "variable",
                  "element": "item",
                  "variable": "vaccItem"
                }, {
                  "context": "vaccItem",
                  "contextType": "variable",
                  "element": "linkId",
                  "transform": "copy",
                  "parameter": [ {
                    "valueString": "form.vaccines.questVaccineProduct"
                  } ]
                }, {
                  "context": "vaccItem",
                  "contextType": "variable",
                  "element": "text",
                  "transform": "copy",
                  "parameter": [ {
                    "valueString": "Impfstoff"
                  } ]
                }, {
                  "context": "vaccItem",
                  "contextType": "variable",
                  "element": "answer",
                  "variable": "answer"
                }, {
                  "context": "answer",
                  "contextType": "variable",
                  "element": "value",
                  "transform": "copy",
                  "parameter": [ {
                    "valueId": "vaccCoding"
                  } ]
                } ]
              } ]
            } ]
          }, {
            "name": "vaccDate",
            "source": [ {
              "context": "resource",
              "element": "occurrenceDateTime",
              "variable": "vaccDate"
            } ],
            "rule": [ {
              "name": "vaccDate",
              "source": [ {
                "context": "vaccDate"
              } ],
              "target": [ {
                "context": "vaccEntry",
                "contextType": "variable",
                "element": "item",
                "variable": "vaccItem"
              }, {
                "context": "vaccItem",
                "contextType": "variable",
                "element": "linkId",
                "transform": "copy",
                "parameter": [ {
                  "valueString": "form.vaccines.questVaccinationDate"
                } ]
              }, {
                "context": "vaccItem",
                "contextType": "variable",
                "element": "text",
                "transform": "copy",
                "parameter": [ {
                  "valueString": "Impfdatum"
                } ]
              }, {
                "context": "vaccItem",
                "contextType": "variable",
                "element": "answer",
                "variable": "answer"
              }, {
                "context": "answer",
                "contextType": "variable",
                "element": "value",
                "variable": "dt",
                "transform": "create",
                "parameter": [ {
                  "valueString": "date"
                } ]
              }, {
                "context": "dt",
                "contextType": "variable",
                "element": "value",
                "transform": "copy",
                "parameter": [ {
                  "valueId": "vaccDate"
                } ]
              } ]
            } ]
          } ]
        } ]
      } ],
      "documentation": "section.entry as secBaIm /*where ($this.type = 'Condition')*/ then {"
    } ]
  }, {
    "name": "MedicalProblemsAddToItemSocial",
    "typeMode": "none",
    "input": [ {
      "name": "rcode",
      "type": "CodeableConcept",
      "mode": "source"
    }, {
      "name": "questSocial",
      "type": "BackboneElement",
      "mode": "target"
    } ],
    "rule": [ {
      "name": "codingsct",
      "source": [ {
        "context": "rcode",
        "element": "coding",
        "variable": "coding",
        "condition": "($this.system = 'http://snomed.info/sct')"
      } ],
      "rule": [ {
        "name": "code",
        "source": [ {
          "context": "coding",
          "element": "code",
          "variable": "code",
          "condition": "(($this.value = '169449001') or ($this.value = '224224003') or ($this.value = '105568001'))"
        } ],
        "rule": [ {
          "name": "answr",
          "source": [ {
            "context": "code"
          } ],
          "target": [ {
            "context": "questSocial",
            "contextType": "variable",
            "element": "answer",
            "variable": "answr"
          }, {
            "context": "answr",
            "contextType": "variable",
            "element": "value",
            "transform": "copy",
            "parameter": [ {
              "valueId": "coding"
            } ]
          } ]
        } ],
        "documentation": "Social"
      } ]
    }, {
      "name": "codinghci",
      "source": [ {
        "context": "rcode",
        "element": "coding",
        "variable": "coding",
        "condition": "($this.system = 'http://hcisolutions.ch/ig/ig-hci-vacd/CodeSystem/hci-vacd-cds-cs')"
      } ],
      "rule": [ {
        "name": "code",
        "source": [ {
          "context": "coding",
          "element": "code",
          "variable": "code",
          "condition": "(($this.value = '300001') or ($this.value = '300002') or ($this.value = '300003') or ($this.value = '300005'))"
        } ],
        "rule": [ {
          "name": "coding",
          "source": [ {
            "context": "code"
          } ],
          "target": [ {
            "context": "questSocial",
            "contextType": "variable",
            "element": "answer",
            "variable": "answr"
          }, {
            "context": "answr",
            "contextType": "variable",
            "element": "value",
            "transform": "copy",
            "parameter": [ {
              "valueId": "coding"
            } ]
          } ]
        } ],
        "documentation": "Social"
      } ]
    } ]
  }, {
    "name": "MedicalProblemsAddToItemPreillness",
    "typeMode": "none",
    "input": [ {
      "name": "rcode",
      "type": "CodeableConcept",
      "mode": "source"
    }, {
      "name": "questPreIllnesses",
      "type": "BackboneElement",
      "mode": "target"
    } ],
    "rule": [ {
      "name": "codingsct",
      "source": [ {
        "context": "rcode",
        "element": "coding",
        "variable": "coding",
        "condition": "($this.system = 'http://snomed.info/sct')"
      } ],
      "rule": [ {
        "name": "code",
        "source": [ {
          "context": "coding",
          "element": "code",
          "variable": "code",
          "condition": "(($this.value = '42261000195101') or ($this.value = '42251000195104') or ($this.value = '449840001') or ($this.value = '50043002') or ($this.value = '737294004') or ($this.value = '51244008') or ($this.value = '230744007') or ($this.value = '363346000') or ($this.value = '51655004') or ($this.value = '235856003') or ($this.value = '402196005') or ($this.value = '90708001') or ($this.value = '414029004') or ($this.value = '56265001') or ($this.value = '75934005') or ($this.value = '34093004') or ($this.value = '24063002'))"
        } ],
        "rule": [ {
          "name": "answr",
          "source": [ {
            "context": "code"
          } ],
          "target": [ {
            "context": "questPreIllnesses",
            "contextType": "variable",
            "element": "answer",
            "variable": "answr"
          }, {
            "context": "answr",
            "contextType": "variable",
            "element": "value",
            "transform": "copy",
            "parameter": [ {
              "valueId": "coding"
            } ]
          } ]
        } ],
        "documentation": "PrevIllness"
      } ]
    }, {
      "name": "codinghci",
      "source": [ {
        "context": "rcode",
        "element": "coding",
        "variable": "coding",
        "condition": "($this.system = 'http://hcisolutions.ch/ig/ig-hci-vacd/CodeSystem/hci-vacd-cds-cs')"
      } ]
    } ]
  }, {
    "name": "MedicalProblemsAddToItemRisks",
    "typeMode": "none",
    "input": [ {
      "name": "rcode",
      "type": "CodeableConcept",
      "mode": "source"
    }, {
      "name": "questRisks",
      "type": "BackboneElement",
      "mode": "target"
    } ],
    "rule": [ {
      "name": "codingsct",
      "source": [ {
        "context": "rcode",
        "element": "coding",
        "variable": "coding",
        "condition": "($this.system = 'http://snomed.info/sct')"
      } ],
      "rule": [ {
        "name": "code",
        "source": [ {
          "context": "coding",
          "element": "code",
          "variable": "code",
          "condition": "(($this.value = '226034001') or ($this.value = '102947004') or ($this.value = '305679000') or ($this.value = '305679000') or ($this.value = '1237016007') or ($this.value = '305679000') or ($this.value = '1237016007') or ($this.value = '1237017003') or ($this.value = '1237018008') or ($this.value = '1237022003') or ($this.value = '1237019000') or ($this.value = '1237020006') or ($this.value = '1237021005') or ($this.value = '1237023008') or ($this.value = '1237024002') or ($this.value = '1237025001') or ($this.value = '1237026000') or ($this.value = '1237027009') or ($this.value = '1237028004') or ($this.value = '1237029007') or ($this.value = '1237030002'))"
        } ],
        "rule": [ {
          "name": "answr",
          "source": [ {
            "context": "code"
          } ],
          "target": [ {
            "context": "questRisks",
            "contextType": "variable",
            "element": "answer",
            "variable": "answr"
          }, {
            "context": "answr",
            "contextType": "variable",
            "element": "value",
            "transform": "copy",
            "parameter": [ {
              "valueId": "coding"
            } ]
          } ]
        } ],
        "documentation": "Riskfactor"
      } ]
    }, {
      "name": "codinghci",
      "source": [ {
        "context": "rcode",
        "element": "coding",
        "variable": "coding",
        "condition": "($this.system = 'http://hcisolutions.ch/ig/ig-hci-vacd/CodeSystem/hci-vacd-cds-cs')"
      } ],
      "rule": [ {
        "name": "code",
        "source": [ {
          "context": "coding",
          "element": "code",
          "variable": "code",
          "condition": "(($this.value = '200001') or ($this.value = '200002') or ($this.value = '200003') or ($this.value = '200005') or ($this.value = '200022') or ($this.value = '200023'))"
        } ],
        "rule": [ {
          "name": "answr",
          "source": [ {
            "context": "code"
          } ],
          "target": [ {
            "context": "questRisks",
            "contextType": "variable",
            "element": "answer",
            "variable": "answr"
          }, {
            "context": "answr",
            "contextType": "variable",
            "element": "value",
            "transform": "copy",
            "parameter": [ {
              "valueId": "coding"
            } ]
          } ]
        } ],
        "documentation": "Riskfactor"
      } ]
    } ]
  }, {
    "name": "MedicalProblemsAddToItemOccupation",
    "typeMode": "none",
    "input": [ {
      "name": "rcode",
      "type": "CodeableConcept",
      "mode": "source"
    }, {
      "name": "questOccupation",
      "type": "BackboneElement",
      "mode": "target"
    } ],
    "rule": [ {
      "name": "codingsct",
      "source": [ {
        "context": "rcode",
        "element": "coding",
        "variable": "coding",
        "condition": "($this.system = 'http://snomed.info/sct')"
      } ],
      "rule": [ {
        "name": "code",
        "source": [ {
          "context": "coding",
          "element": "code",
          "variable": "code",
          "condition": "(($this.value = '310183005') or ($this.value = '160157004') or ($this.value = '265940000') or ($this.value = '61246008'))"
        } ],
        "rule": [ {
          "name": "answr",
          "source": [ {
            "context": "code"
          } ],
          "target": [ {
            "context": "questOccupation",
            "contextType": "variable",
            "element": "answer",
            "variable": "answr"
          }, {
            "context": "answr",
            "contextType": "variable",
            "element": "value",
            "transform": "copy",
            "parameter": [ {
              "valueId": "coding"
            } ]
          } ]
        } ],
        "documentation": "Profession"
      } ]
    }, {
      "name": "codinghci",
      "source": [ {
        "context": "rcode",
        "element": "coding",
        "variable": "coding",
        "condition": "($this.system = 'http://hcisolutions.ch/ig/ig-hci-vacd/CodeSystem/hci-vacd-cds-cs')"
      } ],
      "rule": [ {
        "name": "code",
        "source": [ {
          "context": "coding",
          "element": "code",
          "variable": "code",
          "condition": "(($this.value = '100001') or ($this.value = '100002') or ($this.value = '100003'))"
        } ],
        "rule": [ {
          "name": "coding",
          "source": [ {
            "context": "code"
          } ],
          "target": [ {
            "context": "questOccupation",
            "contextType": "variable",
            "element": "answer",
            "variable": "answr"
          }, {
            "context": "answr",
            "contextType": "variable",
            "element": "value",
            "transform": "copy",
            "parameter": [ {
              "valueId": "coding"
            } ]
          } ]
        } ],
        "documentation": "Profession"
      } ]
    } ]
  }, {
    "name": "DoContained",
    "typeMode": "none",
    "documentation": "group MedicalProblemsAddToItem(source rcode : CodeableConcept, target questSocial : BackboneElement, target questPreIllnesses : BackboneElement, target questRisks : BackboneElement, target questOccupation : BackboneElement) {\r\n// Note: in place of or chaining a resolution of the categorie using a concept map would be nice. mappig does not yet have this functionality\r\nrcode.coding as coding where ($this.system = 'http://snomed.info/sct') then {\r\n// Riskfactor\r\ncoding.code as code where ( $this.value = '226034001' or $this.value = '102947004' or $this.value = '305679000' or $this.value = '305679000' or $this.value = '1237016007' or $this.value = '305679000' or $this.value = '1237016007' or $this.value = '1237017003' or $this.value = '1237018008' or $this.value = '1237022003' or $this.value = '1237019000' or $this.value = '1237020006' or $this.value = '1237021005' or $this.value = '1237023008' or $this.value = '1237024002' or $this.value = '1237025001' or $this.value = '1237026000' or $this.value = '1237027009' or $this.value = '1237028004' or $this.value = '1237029007' or $this.value = '1237030002' ) then {\r\ncode -> questRisks.answer as answr, answr.value = coding \"answr\";\r\n} \"code\";\r\n// PrevIllness\r\ncoding.code as code where ( $this.value = '42261000195101' or $this.value = '42251000195104' or $this.value = '449840001' or $this.value = '50043002' or $this.value = '737294004' or $this.value = '51244008' or $this.value = '230744007' or $this.value = '363346000' or $this.value = '51655004' or $this.value = '235856003' or $this.value = '402196005' or $this.value = '90708001' or $this.value = '414029004' or $this.value = '56265001' or $this.value = '75934005' or $this.value = '34093004' or $this.value = '24063002' ) then {\r\ncode -> questPreIllnesses.answer as answr, answr.value = coding \"answr\";\r\n} \"code\";\r\n// Social\r\ncoding.code as code where ( $this.value = '169449001' or $this.value = '224224003' or $this.value = '105568001') then {\r\ncode -> questSocial.answer as answr, answr.value = coding \"answr\";\r\n} \"code\";\r\n// Profession\r\ncoding.code as code where ( $this.value = '310183005' or $this.value = '160157004' or $this.value = '265940000' or $this.value = '61246008') then {\r\ncode -> questOccupation.answer as answr, answr.value = coding \"answr\";\r\n} \"code\";\r\n} \"codingsct\";\r\nrcode.coding as coding where ($this.system = 'http://hcisolutions.ch/ig/ig-hci-vacd/CodeSystem/hci-vacd-cds-cs') then {\r\n// Riskfactor\r\ncoding.code as code where ( $this.value = '200001' or $this.value = '200002' or $this.value = '200003' or $this.value = '200005' or $this.value = '200022' or $this.value = '200023') then {\r\ncode -> questRisks.answer as answr, answr.value = coding \"answr\";\r\n} \"code\";\r\n// Social\r\ncoding.code as code where ( $this.value = '300001' or $this.value = '300002' or $this.value = '300003' or $this.value = '300005') then {\r\ncode -> questSocial.answer as answr, answr.value = coding \"coding\";\r\n} \"code\";\r\n// Profession\r\ncoding.code as code where ( $this.value = '100001' or $this.value = '100002' or  $this.value = '100003') then {\r\ncode -> questOccupation.answer as answr, answr.value = coding \"coding\";\r\n} \"code\";\r\n} \"codinghci\";\r\n// rcode.coding as coding -> translate(coding, 'http://hcisolutions.ch/ig/ig-hci-vacd/ConceptMap/hci-vacd-medicalrisks-riskcategories-cm', 'CodeableConcept') as displ,\r\n//     questOccupation.answer as answr,\r\n//       answr.value = displ \"translate\";\r\n}",
    "input": [ {
      "name": "entry",
      "type": "BackboneElement",
      "mode": "source"
    }, {
      "name": "qr",
      "type": "QuestionnaireResponse",
      "mode": "target"
    } ],
    "rule": [ {
      "name": "fullUrl",
      "source": [ {
        "context": "entry",
        "element": "fullUrl",
        "variable": "fullUrl"
      } ],
      "rule": [ {
        "name": "patient",
        "source": [ {
          "context": "entry",
          "element": "resource",
          "variable": "patient",
          "condition": "$this.ofType(FHIR.Patient)"
        } ],
        "rule": [ {
          "name": "pat",
          "source": [ {
            "context": "patient"
          } ],
          "target": [ {
            "context": "qr",
            "contextType": "variable",
            "element": "contained",
            "variable": "pat",
            "transform": "copy",
            "parameter": [ {
              "valueId": "patient"
            } ]
          }, {
            "context": "pat",
            "contextType": "variable",
            "element": "id",
            "transform": "copy",
            "parameter": [ {
              "valueId": "fullUrl"
            } ]
          }, {
            "context": "qr",
            "contextType": "variable",
            "element": "subject",
            "variable": "reference",
            "transform": "create",
            "parameter": [ {
              "valueString": "Reference"
            } ]
          }, {
            "context": "reference",
            "contextType": "variable",
            "element": "reference",
            "transform": "evaluate",
            "parameter": [ {
              "valueString": "%pat.id"
            } ]
          } ]
        } ]
      }, {
        "name": "practitionerrole",
        "source": [ {
          "context": "entry",
          "element": "resource",
          "variable": "practitionerrole",
          "condition": "$this.ofType(FHIR.PractitionerRole)"
        } ],
        "rule": [ {
          "name": "pr",
          "source": [ {
            "context": "practitionerrole"
          } ],
          "target": [ {
            "context": "qr",
            "contextType": "variable",
            "element": "contained",
            "variable": "pr",
            "transform": "copy",
            "parameter": [ {
              "valueId": "practitionerrole"
            } ]
          }, {
            "context": "pr",
            "contextType": "variable",
            "element": "id",
            "transform": "copy",
            "parameter": [ {
              "valueId": "fullUrl"
            } ]
          }, {
            "context": "qr",
            "contextType": "variable",
            "element": "author",
            "variable": "reference",
            "transform": "create",
            "parameter": [ {
              "valueString": "Reference"
            } ]
          }, {
            "context": "reference",
            "contextType": "variable",
            "element": "reference",
            "transform": "evaluate",
            "parameter": [ {
              "valueString": "%pr.id"
            } ]
          } ]
        } ]
      }, {
        "name": "practitioner",
        "source": [ {
          "context": "entry",
          "element": "resource",
          "variable": "practitioner",
          "condition": "$this.ofType(FHIR.Practitioner)"
        } ],
        "rule": [ {
          "name": "pract",
          "source": [ {
            "context": "practitioner"
          } ],
          "target": [ {
            "context": "qr",
            "contextType": "variable",
            "element": "contained",
            "variable": "pra",
            "transform": "copy",
            "parameter": [ {
              "valueId": "practitioner"
            } ]
          }, {
            "context": "pra",
            "contextType": "variable",
            "element": "id",
            "transform": "copy",
            "parameter": [ {
              "valueId": "fullUrl"
            } ]
          } ]
        } ]
      }, {
        "name": "organization",
        "source": [ {
          "context": "entry",
          "element": "resource",
          "variable": "organization",
          "condition": "$this.ofType(FHIR.Organization)"
        } ],
        "rule": [ {
          "name": "org",
          "source": [ {
            "context": "organization"
          } ],
          "target": [ {
            "context": "qr",
            "contextType": "variable",
            "element": "contained",
            "variable": "org",
            "transform": "copy",
            "parameter": [ {
              "valueId": "organization"
            } ]
          }, {
            "context": "org",
            "contextType": "variable",
            "element": "id",
            "transform": "copy",
            "parameter": [ {
              "valueId": "fullUrl"
            } ]
          } ]
        } ]
      } ]
    } ]
  }, {
    "name": "DoTiterAndIllnesses",
    "typeMode": "none",
    "input": [ {
      "name": "bundle",
      "type": "Bundle",
      "mode": "source"
    }, {
      "name": "titerandillnesses",
      "type": "BackboneElement",
      "mode": "target"
    } ],
    "rule": [ {
      "name": "entry",
      "source": [ {
        "context": "bundle",
        "element": "entry",
        "variable": "entry",
        "condition": "($this.resource.ofType(FHIR.Observation))"
      } ],
      "rule": [ {
        "name": "resource",
        "source": [ {
          "context": "entry",
          "element": "resource",
          "variable": "resource"
        } ],
        "rule": [ {
          "name": "cc",
          "source": [ {
            "context": "resource",
            "element": "code",
            "variable": "cc"
          } ],
          "rule": [ {
            "name": "value",
            "source": [ {
              "context": "resource",
              "element": "value",
              "variable": "value"
            } ],
            "rule": [ {
              "name": "coding",
              "source": [ {
                "context": "cc",
                "element": "coding",
                "variable": "coding",
                "condition": "(($this.system = 'http://loinc.org') and ($this.code = '22755-3'))"
              } ],
              "rule": [ {
                "name": "value",
                "source": [ {
                  "context": "value",
                  "element": "value",
                  "variable": "valQu"
                } ],
                "target": [ {
                  "context": "titerandillnesses",
                  "contextType": "variable",
                  "element": "item",
                  "variable": "hibTit"
                }, {
                  "context": "hibTit",
                  "contextType": "variable",
                  "element": "linkId",
                  "transform": "copy",
                  "parameter": [ {
                    "valueString": "form.patientinfo.questHibKnownTiter"
                  } ]
                }, {
                  "context": "hibTit",
                  "contextType": "variable",
                  "element": "text",
                  "transform": "copy",
                  "parameter": [ {
                    "valueString": "Hämophilus influenzae Typ b (mg/l)"
                  } ]
                }, {
                  "context": "hibTit",
                  "contextType": "variable",
                  "element": "answer",
                  "variable": "answ"
                }, {
                  "context": "answ",
                  "contextType": "variable",
                  "element": "value",
                  "transform": "copy",
                  "parameter": [ {
                    "valueId": "valQu"
                  } ]
                } ]
              } ],
              "documentation": "form.patientinfo.questHibKnownTiter"
            }, {
              "name": "coding",
              "source": [ {
                "context": "cc",
                "element": "coding",
                "variable": "coding",
                "condition": "(($this.system = 'http://loinc.org') and ($this.code = '22602-7'))"
              } ],
              "rule": [ {
                "name": "value",
                "source": [ {
                  "context": "value",
                  "element": "value",
                  "variable": "valQu"
                } ],
                "target": [ {
                  "context": "titerandillnesses",
                  "contextType": "variable",
                  "element": "item",
                  "variable": "hibTit"
                }, {
                  "context": "hibTit",
                  "contextType": "variable",
                  "element": "linkId",
                  "transform": "copy",
                  "parameter": [ {
                    "valueString": "form.patientinfo.questVarizKnownTiter"
                  } ]
                }, {
                  "context": "hibTit",
                  "contextType": "variable",
                  "element": "text",
                  "transform": "copy",
                  "parameter": [ {
                    "valueString": "Varizellen (IU/l)"
                  } ]
                }, {
                  "context": "hibTit",
                  "contextType": "variable",
                  "element": "answer",
                  "variable": "answ"
                }, {
                  "context": "answ",
                  "contextType": "variable",
                  "element": "value",
                  "transform": "copy",
                  "parameter": [ {
                    "valueId": "valQu"
                  } ]
                } ]
              } ],
              "documentation": "form.patientinfo.questVarizKnownTiter"
            }, {
              "name": "coding",
              "source": [ {
                "context": "cc",
                "element": "coding",
                "variable": "coding",
                "condition": "(($this.system = 'http://loinc.org') and ($this.code = '16935-9'))"
              } ],
              "rule": [ {
                "name": "value",
                "source": [ {
                  "context": "value",
                  "element": "value",
                  "variable": "valQu"
                } ],
                "target": [ {
                  "context": "titerandillnesses",
                  "contextType": "variable",
                  "element": "item",
                  "variable": "hibTit"
                }, {
                  "context": "hibTit",
                  "contextType": "variable",
                  "element": "linkId",
                  "transform": "copy",
                  "parameter": [ {
                    "valueString": "form.patientinfo.questHepBAntibodyTiter"
                  } ]
                }, {
                  "context": "hibTit",
                  "contextType": "variable",
                  "element": "text",
                  "transform": "copy",
                  "parameter": [ {
                    "valueString": "Hepatitis B (IU/l)"
                  } ]
                }, {
                  "context": "hibTit",
                  "contextType": "variable",
                  "element": "answer",
                  "variable": "answ"
                }, {
                  "context": "answ",
                  "contextType": "variable",
                  "element": "value",
                  "transform": "copy",
                  "parameter": [ {
                    "valueId": "valQu"
                  } ]
                } ]
              } ],
              "documentation": "form.patientinfo.questHepBAntibodyTiter"
            }, {
              "name": "coding",
              "source": [ {
                "context": "cc",
                "element": "coding",
                "variable": "coding",
                "condition": "(($this.system = 'http://loinc.org') and ($this.code = '14128-3'))"
              } ],
              "rule": [ {
                "name": "value",
                "source": [ {
                  "context": "value",
                  "element": "value",
                  "variable": "valQu"
                } ],
                "target": [ {
                  "context": "titerandillnesses",
                  "contextType": "variable",
                  "element": "item",
                  "variable": "hibTit"
                }, {
                  "context": "hibTit",
                  "contextType": "variable",
                  "element": "linkId",
                  "transform": "copy",
                  "parameter": [ {
                    "valueString": "form.patientinfo.questTwutAntibodyTiter"
                  } ]
                }, {
                  "context": "hibTit",
                  "contextType": "variable",
                  "element": "text",
                  "transform": "copy",
                  "parameter": [ {
                    "valueString": "Tollwut (IU/ml)"
                  } ]
                }, {
                  "context": "hibTit",
                  "contextType": "variable",
                  "element": "answer",
                  "variable": "answ"
                }, {
                  "context": "answ",
                  "contextType": "variable",
                  "element": "value",
                  "transform": "copy",
                  "parameter": [ {
                    "valueId": "valQu"
                  } ]
                } ]
              } ],
              "documentation": "form.patientinfo.questTwutAntibodyTiter"
            } ]
          } ],
          "documentation": "resource.meta where ($this.profile = 'http://fhir.ch/ig/ch-vacd/StructureDefinition/ch-vacd-laboratory-serology') then {"
        } ]
      } ],
      "documentation": "Lab results"
    }, {
      "name": "entry",
      "source": [ {
        "context": "bundle",
        "element": "entry",
        "variable": "entry",
        "condition": "($this.resource.ofType(FHIR.Condition))"
      } ],
      "rule": [ {
        "name": "resource",
        "source": [ {
          "context": "entry",
          "element": "resource",
          "variable": "resource"
        } ],
        "rule": [ {
          "name": "cc",
          "source": [ {
            "context": "resource",
            "element": "code",
            "variable": "cc"
          } ],
          "rule": [ {
            "name": "coding",
            "source": [ {
              "context": "cc",
              "element": "coding",
              "variable": "coding",
              "condition": "(($this.system = 'http://snomed.info/sct') and ($this.code = '38907003'))"
            } ],
            "rule": [ {
              "name": "value",
              "source": [ {
                "context": "coding"
              } ],
              "target": [ {
                "context": "titerandillnesses",
                "contextType": "variable",
                "element": "item",
                "variable": "illUnder"
              }, {
                "context": "illUnder",
                "contextType": "variable",
                "element": "linkId",
                "transform": "copy",
                "parameter": [ {
                  "valueString": "form.patientinfo.questVarizIllUndergone"
                } ]
              }, {
                "context": "illUnder",
                "contextType": "variable",
                "element": "text",
                "transform": "copy",
                "parameter": [ {
                  "valueString": "Wurde bereits eine Varizellen-Erkrankung durchgemacht?"
                } ]
              }, {
                "context": "illUnder",
                "contextType": "variable",
                "element": "answer",
                "variable": "answ"
              }, {
                "context": "answ",
                "contextType": "variable",
                "element": "value",
                "transform": "copy",
                "parameter": [ {
                  "valueBoolean": true
                } ]
              } ]
            } ],
            "documentation": "form.patientinfo.questVarizIllUndergone"
          }, {
            "name": "coding",
            "source": [ {
              "context": "cc",
              "element": "coding",
              "variable": "coding",
              "condition": "(($this.system = 'http://snomed.info/sct') and ($this.code = '36653000'))"
            } ],
            "rule": [ {
              "name": "value",
              "source": [ {
                "context": "coding"
              } ],
              "target": [ {
                "context": "titerandillnesses",
                "contextType": "variable",
                "element": "item",
                "variable": "illUnder"
              }, {
                "context": "illUnder",
                "contextType": "variable",
                "element": "linkId",
                "transform": "copy",
                "parameter": [ {
                  "valueString": "form.patientinfo.questRubeusIllUndergone"
                } ]
              }, {
                "context": "illUnder",
                "contextType": "variable",
                "element": "text",
                "transform": "copy"
              }, {
                "context": "illUnder",
                "contextType": "variable",
                "element": "answer",
                "variable": "answ"
              }, {
                "context": "answ",
                "contextType": "variable",
                "element": "value",
                "transform": "copy",
                "parameter": [ {
                  "valueBoolean": true
                } ]
              } ]
            } ],
            "documentation": "form.patientinfo.questRubeusIllUndergone"
          }, {
            "name": "coding",
            "source": [ {
              "context": "cc",
              "element": "coding",
              "variable": "coding",
              "condition": "(($this.system = 'http://snomed.info/sct') and ($this.code = '14189004'))"
            } ],
            "rule": [ {
              "name": "value",
              "source": [ {
                "context": "coding"
              } ],
              "target": [ {
                "context": "titerandillnesses",
                "contextType": "variable",
                "element": "item",
                "variable": "illUnder"
              }, {
                "context": "illUnder",
                "contextType": "variable",
                "element": "linkId",
                "transform": "copy",
                "parameter": [ {
                  "valueString": "form.patientinfo.questMeasleIllUndergone"
                } ]
              }, {
                "context": "illUnder",
                "contextType": "variable",
                "element": "text",
                "transform": "copy"
              }, {
                "context": "illUnder",
                "contextType": "variable",
                "element": "answer",
                "variable": "answ"
              }, {
                "context": "answ",
                "contextType": "variable",
                "element": "value",
                "transform": "copy",
                "parameter": [ {
                  "valueBoolean": true
                } ]
              } ]
            } ],
            "documentation": "form.patientinfo.questMeasleIllUndergone"
          }, {
            "name": "coding",
            "source": [ {
              "context": "cc",
              "element": "coding",
              "variable": "coding",
              "condition": "(($this.system = 'http://snomed.info/sct') and ($this.code = '40468003'))"
            } ],
            "rule": [ {
              "name": "value",
              "source": [ {
                "context": "coding"
              } ],
              "target": [ {
                "context": "titerandillnesses",
                "contextType": "variable",
                "element": "item",
                "variable": "illUnder"
              }, {
                "context": "illUnder",
                "contextType": "variable",
                "element": "linkId",
                "transform": "copy",
                "parameter": [ {
                  "valueString": "form.patientinfo.questHepAIllUndergone"
                } ]
              }, {
                "context": "illUnder",
                "contextType": "variable",
                "element": "text",
                "transform": "copy",
                "parameter": [ {
                  "valueString": "Wurde bereits eine Hepatitis A-Erkrankung durchgemacht?"
                } ]
              }, {
                "context": "illUnder",
                "contextType": "variable",
                "element": "answer",
                "variable": "answ"
              }, {
                "context": "answ",
                "contextType": "variable",
                "element": "value",
                "transform": "copy",
                "parameter": [ {
                  "valueBoolean": true
                } ]
              } ]
            } ],
            "documentation": "form.patientinfo.questHepAIllUndergone"
          }, {
            "name": "coding",
            "source": [ {
              "context": "cc",
              "element": "coding",
              "variable": "coding",
              "condition": "(($this.system = 'http://snomed.info/sct') and ($this.code = '66071002'))"
            } ],
            "rule": [ {
              "name": "value",
              "source": [ {
                "context": "coding"
              } ],
              "target": [ {
                "context": "titerandillnesses",
                "contextType": "variable",
                "element": "item",
                "variable": "illUnder"
              }, {
                "context": "illUnder",
                "contextType": "variable",
                "element": "linkId",
                "transform": "copy",
                "parameter": [ {
                  "valueString": "form.patientinfo.questHepBIllUndergone"
                } ]
              }, {
                "context": "illUnder",
                "contextType": "variable",
                "element": "text",
                "transform": "copy",
                "parameter": [ {
                  "valueString": "Wurde bereits eine Hepatitis B-Erkrankung durchgemacht?"
                } ]
              }, {
                "context": "illUnder",
                "contextType": "variable",
                "element": "answer",
                "variable": "answ"
              }, {
                "context": "answ",
                "contextType": "variable",
                "element": "value",
                "transform": "copy",
                "parameter": [ {
                  "valueBoolean": true
                } ]
              } ]
            } ],
            "documentation": "form.patientinfo.questHepBIllUndergone"
          } ],
          "documentation": "resource.meta where ($this.profile = 'http://fhir.ch/ig/ch-vacd/StructureDefinition/ch-vacd-pastillnesses') then {"
        } ]
      } ],
      "documentation": "pastillnesses"
    } ]
  }, {
    "name": "DoPatinfoGeneric",
    "typeMode": "none",
    "input": [ {
      "name": "bundle",
      "type": "Bundle",
      "mode": "source"
    }, {
      "name": "patientinfo",
      "type": "BackboneElement",
      "mode": "target"
    } ],
    "rule": [ {
      "name": "questSocial",
      "source": [ {
        "context": "bundle"
      } ],
      "target": [ {
        "context": "patientinfo",
        "contextType": "variable",
        "element": "item",
        "variable": "questSocial"
      } ],
      "rule": [ {
        "name": "linkIdtext",
        "source": [ {
          "context": "bundle"
        } ],
        "target": [ {
          "context": "questSocial",
          "contextType": "variable",
          "element": "linkId",
          "transform": "copy",
          "parameter": [ {
            "valueString": "form.patientinfo.questSocialFacts"
          } ]
        }, {
          "context": "questSocial",
          "contextType": "variable",
          "element": "text",
          "transform": "copy",
          "parameter": [ {
            "valueString": "Soziale Faktoren"
          } ]
        } ]
      }, {
        "name": "questSocialLivingRisk",
        "source": [ {
          "context": "bundle"
        } ],
        "target": [ {
          "context": "patientinfo",
          "contextType": "variable",
          "element": "item",
          "variable": "questSocialLivingRisk"
        } ],
        "rule": [ {
          "name": "answSocialLivingRisk",
          "source": [ {
            "context": "bundle"
          } ],
          "target": [ {
            "context": "questSocialLivingRisk",
            "contextType": "variable",
            "element": "linkId",
            "transform": "copy",
            "parameter": [ {
              "valueString": "form.patientinfo.questSocialLivingRisk"
            } ]
          }, {
            "context": "questSocialLivingRisk",
            "contextType": "variable",
            "element": "text",
            "transform": "copy",
            "parameter": [ {
              "valueString": "Ist der Wohnort oder Aufenthalt innerhalb CH ausser Genf und Tessin? (FSME)"
            } ]
          }, {
            "context": "questSocialLivingRisk",
            "contextType": "variable",
            "element": "answer",
            "variable": "answSocialLivingRisk"
          } ],
          "rule": [ {
            "name": "questPreIllnesses",
            "source": [ {
              "context": "bundle"
            } ],
            "target": [ {
              "context": "patientinfo",
              "contextType": "variable",
              "element": "item",
              "variable": "questPreIllnesses"
            } ],
            "rule": [ {
              "name": "linkIdtext",
              "source": [ {
                "context": "bundle"
              } ],
              "target": [ {
                "context": "questPreIllnesses",
                "contextType": "variable",
                "element": "linkId",
                "transform": "copy",
                "parameter": [ {
                  "valueString": "form.patientinfo.questPreIllnesses"
                } ]
              }, {
                "context": "questPreIllnesses",
                "contextType": "variable",
                "element": "text",
                "transform": "copy",
                "parameter": [ {
                  "valueString": "Vorerkrankungen"
                } ]
              } ]
            }, {
              "name": "questRisks",
              "source": [ {
                "context": "bundle"
              } ],
              "target": [ {
                "context": "patientinfo",
                "contextType": "variable",
                "element": "item",
                "variable": "questRisks"
              } ],
              "rule": [ {
                "name": "linkIdtext",
                "source": [ {
                  "context": "bundle"
                } ],
                "target": [ {
                  "context": "questRisks",
                  "contextType": "variable",
                  "element": "linkId",
                  "transform": "copy",
                  "parameter": [ {
                    "valueString": "form.patientinfo.questRisks"
                  } ]
                }, {
                  "context": "questRisks",
                  "contextType": "variable",
                  "element": "text",
                  "transform": "copy",
                  "parameter": [ {
                    "valueString": "Risikofaktoren"
                  } ]
                } ]
              }, {
                "name": "questPregnancy",
                "source": [ {
                  "context": "bundle"
                } ],
                "target": [ {
                  "context": "patientinfo",
                  "contextType": "variable",
                  "element": "item",
                  "variable": "questPregnancy"
                } ],
                "rule": [ {
                  "name": "answPreg",
                  "source": [ {
                    "context": "bundle"
                  } ],
                  "target": [ {
                    "context": "questPregnancy",
                    "contextType": "variable",
                    "element": "linkId",
                    "transform": "copy",
                    "parameter": [ {
                      "valueString": "form.patientinfo.questPregnancy"
                    } ]
                  }, {
                    "context": "questPregnancy",
                    "contextType": "variable",
                    "element": "text",
                    "transform": "copy",
                    "parameter": [ {
                      "valueString": "Ist die Person schwanger?"
                    } ]
                  }, {
                    "context": "questPregnancy",
                    "contextType": "variable",
                    "element": "answer",
                    "variable": "answPreg"
                  } ],
                  "rule": [ {
                    "name": "questOccupation",
                    "source": [ {
                      "context": "bundle"
                    } ],
                    "target": [ {
                      "context": "patientinfo",
                      "contextType": "variable",
                      "element": "item",
                      "variable": "questOccupation"
                    } ],
                    "rule": [ {
                      "name": "linkIdtext",
                      "source": [ {
                        "context": "bundle"
                      } ],
                      "target": [ {
                        "context": "questOccupation",
                        "contextType": "variable",
                        "element": "linkId",
                        "transform": "copy",
                        "parameter": [ {
                          "valueString": "form.patientinfo.questOccupation"
                        } ]
                      }, {
                        "context": "questOccupation",
                        "contextType": "variable",
                        "element": "text",
                        "transform": "copy",
                        "parameter": [ {
                          "valueString": "Beruf"
                        } ]
                      } ]
                    }, {
                      "name": "entry",
                      "source": [ {
                        "context": "bundle",
                        "element": "entry",
                        "variable": "entry",
                        "condition": "($this.resource.ofType(FHIR.Condition))"
                      } ],
                      "rule": [ {
                        "name": "resource",
                        "source": [ {
                          "context": "entry",
                          "element": "resource",
                          "variable": "resource",
                          "condition": "(($this.code.coding.code != '77386006') and ($this.code.coding.code != '300005'))"
                        } ],
                        "rule": [ {
                          "name": "value",
                          "source": [ {
                            "context": "resource",
                            "element": "code",
                            "variable": "rcode"
                          } ],
                          "dependent": [ {
                            "name": "MedicalProblemsAddToItemSocial",
                            "variable": [ "rcode", "questSocial" ],
                            "_variable": [ {
                              "extension": [ {
                                "url": "http://hl7.org/fhir/tools/StructureDefinition/original-item-type",
                                "valueUrl": "id"
                              } ]
                            }, {
                              "extension": [ {
                                "url": "http://hl7.org/fhir/tools/StructureDefinition/original-item-type",
                                "valueUrl": "id"
                              } ]
                            } ]
                          } ],
                          "documentation": "resource.meta where ($this.profile = 'http://fhir.ch/ig/ch-vacd/StructureDefinition/ch-vacd-medical-problems') then {"
                        }, {
                          "name": "value",
                          "source": [ {
                            "context": "resource",
                            "element": "code",
                            "variable": "rcode"
                          } ],
                          "dependent": [ {
                            "name": "MedicalProblemsAddToItemPreillness",
                            "variable": [ "rcode", "questPreIllnesses" ],
                            "_variable": [ {
                              "extension": [ {
                                "url": "http://hl7.org/fhir/tools/StructureDefinition/original-item-type",
                                "valueUrl": "id"
                              } ]
                            }, {
                              "extension": [ {
                                "url": "http://hl7.org/fhir/tools/StructureDefinition/original-item-type",
                                "valueUrl": "id"
                              } ]
                            } ]
                          } ]
                        }, {
                          "name": "value",
                          "source": [ {
                            "context": "resource",
                            "element": "code",
                            "variable": "rcode"
                          } ],
                          "dependent": [ {
                            "name": "MedicalProblemsAddToItemRisks",
                            "variable": [ "rcode", "questRisks" ],
                            "_variable": [ {
                              "extension": [ {
                                "url": "http://hl7.org/fhir/tools/StructureDefinition/original-item-type",
                                "valueUrl": "id"
                              } ]
                            }, {
                              "extension": [ {
                                "url": "http://hl7.org/fhir/tools/StructureDefinition/original-item-type",
                                "valueUrl": "id"
                              } ]
                            } ]
                          } ]
                        }, {
                          "name": "value",
                          "source": [ {
                            "context": "resource",
                            "element": "code",
                            "variable": "rcode"
                          } ],
                          "dependent": [ {
                            "name": "MedicalProblemsAddToItemOccupation",
                            "variable": [ "rcode", "questOccupation" ],
                            "_variable": [ {
                              "extension": [ {
                                "url": "http://hl7.org/fhir/tools/StructureDefinition/original-item-type",
                                "valueUrl": "id"
                              } ]
                            }, {
                              "extension": [ {
                                "url": "http://hl7.org/fhir/tools/StructureDefinition/original-item-type",
                                "valueUrl": "id"
                              } ]
                            } ]
                          } ]
                        } ]
                      }, {
                        "name": "resource",
                        "source": [ {
                          "context": "entry",
                          "element": "resource",
                          "variable": "resource",
                          "condition": "(($this.code.coding.code = '77386006') and ($this.code.coding.system = 'http://snomed.info/sct'))"
                        } ],
                        "rule": [ {
                          "name": "valueBoolean",
                          "source": [ {
                            "context": "entry"
                          } ],
                          "target": [ {
                            "context": "answPreg",
                            "contextType": "variable",
                            "element": "value",
                            "transform": "copy",
                            "parameter": [ {
                              "valueBoolean": true
                            } ]
                          } ]
                        } ]
                      }, {
                        "name": "resource",
                        "source": [ {
                          "context": "entry",
                          "element": "resource",
                          "variable": "resource",
                          "condition": "(($this.code.coding.code = '300005') and ($this.code.coding.system = 'http://hcisolutions.ch/ig/ig-hci-vacd/CodeSystem/hci-vacd-cds-cs'))"
                        } ],
                        "rule": [ {
                          "name": "valueBoolean",
                          "source": [ {
                            "context": "entry"
                          } ],
                          "target": [ {
                            "context": "answSocialLivingRisk",
                            "contextType": "variable",
                            "element": "value",
                            "transform": "copy",
                            "parameter": [ {
                              "valueBoolean": true
                            } ]
                          } ]
                        } ],
                        "documentation": "HCIC#300005 \"residence or stay whole CH except Geneva and Ticino\""
                      } ]
                    } ],
                    "documentation": "form.patientinfo.questOccupation"
                  } ]
                } ],
                "documentation": "form.patientinfo.questPregnancy"
              } ],
              "documentation": "form.patientinfo.questRisks"
            } ],
            "documentation": "form.patientinfo.questPreIllnesses"
          } ]
        } ],
        "documentation": "form.patientinfo.questSocialLivingRisk"
      } ],
      "documentation": "form.patientinfo.questSocialFacts"
    }, {
      "name": "entry",
      "source": [ {
        "context": "bundle",
        "element": "entry",
        "variable": "entry1",
        "condition": "($this.resource.ofType(FHIR.AllergyIntolerance))"
      } ],
      "rule": [ {
        "name": "questAll",
        "source": [ {
          "context": "bundle"
        } ],
        "target": [ {
          "context": "patientinfo",
          "contextType": "variable",
          "element": "item",
          "variable": "questAll"
        } ],
        "rule": [ {
          "name": "linkId",
          "source": [ {
            "context": "bundle"
          } ],
          "target": [ {
            "context": "questAll",
            "contextType": "variable",
            "element": "linkId",
            "transform": "copy",
            "parameter": [ {
              "valueString": "form.patientinfo.questAllergies"
            } ]
          } ]
        }, {
          "name": "text",
          "source": [ {
            "context": "bundle"
          } ],
          "target": [ {
            "context": "questAll",
            "contextType": "variable",
            "element": "text",
            "transform": "copy",
            "parameter": [ {
              "valueString": "Allergien / UAW"
            } ]
          } ]
        }, {
          "name": "res",
          "source": [ {
            "context": "entry1",
            "element": "resource",
            "variable": "res"
          } ],
          "rule": [ {
            "name": "code",
            "source": [ {
              "context": "res",
              "element": "code",
              "variable": "code1"
            } ],
            "rule": [ {
              "name": "coding",
              "source": [ {
                "context": "code1",
                "element": "coding",
                "variable": "coding1"
              } ],
              "target": [ {
                "context": "questAll",
                "contextType": "variable",
                "element": "answer",
                "variable": "answ1"
              }, {
                "context": "answ1",
                "contextType": "variable",
                "element": "value",
                "transform": "copy",
                "parameter": [ {
                  "valueId": "coding1"
                } ]
              } ]
            } ]
          } ]
        } ]
      } ],
      "documentation": "form.patientinfo.questVivoVaccineReceived"
    } ]
  } ]
}